<!doctype html>
<html lang="tr">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>KarÄ±cÄ±m | Serhat Kiraz </title>
<style>
  :root{
    --bg:#081018;
    --cell-bg:#0f1114;
    --cell-size: min(9vmin,44px);
    --accent: #3ad1b8;
  }
  *{box-sizing:border-box;margin:0;padding:0}
  html,body{background:var(--bg);color:#ddd;font-family:system-ui;height:100vh;display:flex;align-items:center;justify-content:center;overflow:hidden;touch-action:none;-webkit-user-select:none;user-select:none;}
  
  .container{
    display:flex;
    flex-direction:column;
    align-items:center;
    gap:2rem;
    padding:1rem;
  }
  
  .board{
    display:grid;
    grid-template-columns:repeat(9,var(--cell-size));
    grid-template-rows:repeat(9,var(--cell-size));
    gap:0;
    padding:6px;
    background:linear-gradient(180deg,#041018,#071822);
    border-radius:12px;
    box-shadow:0 8px 30px rgba(0,0,0,.6);
    touch-action: none;
  }
  
  .cell{
    background:var(--cell-bg);
    border:1px solid rgba(255,255,255,0.04);
    position:relative;
  }
  
  .cell.valid::after,
  .cell.invalid::after{
    content:'';
    position:absolute;
    inset:0;
    border-radius:4px;
    pointer-events:none;
  }
  
  .cell.valid::after{background:rgba(46,204,113,0.18)}
  .cell.invalid::after{background:rgba(231,76,60,0.18)}
  
  .fill{
    position:absolute;
    inset:0;
    border-radius:4px;
    box-shadow:inset 0 2px 6px rgba(0,0,0,.4);
  }
  
  .picker-area {
    display: flex;
    flex-direction: column;
    gap: 1rem;
    align-items: center;
    touch-action: none;
  }
  
  .picker{
    display:flex;
    gap:1rem;
    height:calc(var(--cell-size) * 2.4);
    align-items:center;
  }
  
  .rotate-btn {
    background: linear-gradient(135deg, #3ad1b8, #2ab8a0);
    color: #081018;
    border: none;
    padding: 0.8rem 1.5rem;
    font-size: 1rem;
    border-radius: 50px;
    cursor: pointer;
    font-weight: bold;
    transition: transform 0.2s, box-shadow 0.2s;
    display: flex;
    align-items: center;
    gap: 0.5rem;
    margin-top: 1rem;
  -webkit-tap-highlight-color: transparent; /* Mobil tÄ±klama efekti */
  user-select: none; /* Metin seÃ§imini engelle */
  }
  
  .rotate-btn:hover {
    transform: translateY(-2px);
    box-shadow: 0 10px 20px rgba(58,209,184,0.3);
  }
  
  .rotate-btn:active {
    transform: translateY(0);
  }
  
  .rotate-btn:disabled {
    background: linear-gradient(135deg, #666, #555);
    color: #888;
    cursor: not-allowed;
    transform: none;
    box-shadow: none;
  }
  /* Buton disabled deÄŸilse hover efekti */
.rotate-btn:not(:disabled):hover {
  transform: translateY(-2px);
  box-shadow: 0 10px 20px rgba(58,209,184,0.3);
}

/* Buton disabled deÄŸilse aktif efekti */
.rotate-btn:not(:disabled):active {
  transform: translateY(0);
}
  .piece{
    display:grid;
    gap:6px;
    padding:6px;
    border-radius:8px;
    cursor:grab;
    position:relative;
    transition:transform 0.2s, opacity 0.2s;
  }
  
  .piece:hover{
    transform:translateY(-2px);
  }
  
  .piece:active{cursor:grabbing}
  
  .slot{
    width:var(--cell-size);
    height:var(--cell-size);
    display:flex;
    align-items:center;
    justify-content:center;
  }
  
  .block{
    width:100%;
    height:100%;
    border-radius:6px;
    box-shadow:0 6px 12px rgba(0,0,0,.3);
  }
  
  .ghost{
    position:fixed;
    pointer-events:none;
    z-index:1000;
    opacity:0.9;
    transform:translate(-50%,-50%);
    border-radius:8px;
    display:grid;
    gap:6px;
    padding:6px;
  }
  
  /* Oyun BitiÅŸ EkranÄ± */
  .game-over{
    position:fixed;
    top:0;
    left:0;
    width:100%;
    height:100%;
    background:rgba(8,16,24,0.95);
    display:flex;
    flex-direction:column;
    align-items:center;
    justify-content:center;
    z-index:2000;
    opacity:0;
    visibility:hidden;
    transition:opacity 0.3s, visibility 0.3s;
  }
  
  .game-over.active{
    opacity:1;
    visibility:visible;
  }
  
  .game-over-content{
    background:linear-gradient(135deg,#0a1824,#0f1e2a);
    padding:3rem;
    border-radius:20px;
    text-align:center;
    max-width:500px;
    width:90%;
    border:1px solid rgba(58,209,184,0.2);
    box-shadow:0 20px 50px rgba(0,0,0,0.5);
  }
  
  .game-over h2{
    font-size:2.5rem;
    color:#3ad1b8;
    margin-bottom:1rem;
    text-shadow:0 0 10px rgba(58,209,184,0.3);
  }
  
  .game-over p{
    font-size:1.2rem;
    margin-bottom:2rem;
    opacity:0.8;
  }
  
  .stats{
    display:grid;
    grid-template-columns:repeat(2,1fr);
    gap:1rem;
    margin:2rem 0;
  }
  
  .stat-item{
    background:rgba(255,255,255,0.05);
    padding:1rem;
    border-radius:10px;
  }
  
  .stat-value{
    font-size:2rem;
    font-weight:bold;
    color:#3ad1b8;
  }
  
  .stat-label{
    font-size:0.9rem;
    opacity:0.7;
    margin-top:0.5rem;
  }
  
  .restart-btn{
    background:linear-gradient(135deg,#3ad1b8,#2ab8a0);
    color:#081018;
    border:none;
    padding:1rem 3rem;
    font-size:1.2rem;
    border-radius:50px;
    cursor:pointer;
    margin-top:2rem;
    font-weight:bold;
    transition:transform 0.2s, box-shadow 0.2s;
  }
  
  .restart-btn:hover{
    transform:translateY(-2px);
    box-shadow:0 10px 20px rgba(58,209,184,0.3);
  }
  
  /* Skor GÃ¶stergesi */
  .score-display{
    position:absolute;
    top:1rem;
    right:1rem;
    background:rgba(15,17,20,0.8);
    padding:0.8rem 1.5rem;
    border-radius:10px;
    font-size:1.1rem;
    border:1px solid rgba(58,209,184,0.3);
  }
  
  .score-value{
    color:#3ad1b8;
    font-weight:bold;
    font-size:1.3rem;
  }
  
  /* Skor animasyonu */
  .score-popup{
    position:fixed;
    color:#3ad1b8;
    font-weight:bold;
    font-size:1.5rem;
    pointer-events:none;
    z-index:1500;
    animation:scorePopup 1s ease-out forwards;
    text-shadow:0 0 10px rgba(58,209,184,0.5);
  }
  
  @keyframes scorePopup{
    0%{ opacity:0; transform:translateY(0) scale(0.5); }
    50%{ opacity:1; transform:translateY(-30px) scale(1.2); }
    100%{ opacity:0; transform:translateY(-60px) scale(1); }
  }
  
/* ESKÄ° HALÄ°
.bonus-info{
  position:fixed;
  bottom:2rem;
  left:50%;
  transform:translateX(-50%);
  background:rgba(15,17,20,0.9);
  padding:0.8rem 1.5rem;
  border-radius:10px;
  font-size:0.9rem;
  border:1px solid rgba(46,204,113,0.3);
  color:#2ecc71;
  z-index:100;
  opacity:0;
  transition:opacity 0.3s;
}

.bonus-info.show{
  opacity:1;
}
*/

/* YENÄ° HALÄ° - Tamamen Gizle */
.bonus-info{
  display: none !important;
  visibility: hidden !important;
  opacity: 0 !important;
}

/* PARÃ‡ALANMA EFEKTÄ° - YENÄ° EKLENDÄ° */
.fragment {
    position: absolute;
    width: calc(var(--cell-size) / 2);
    height: calc(var(--cell-size) / 2);
    border-radius: 50%;
    pointer-events: none;
    z-index: 1000;
    opacity: 1;
    transform-origin: center;
}

@keyframes explode {
    0% {
        opacity: 1;
        transform: translate(0, 0) scale(1) rotate(0deg);
        filter: brightness(1) blur(0px);
    }
    50% {
        opacity: 0.9;
        filter: brightness(1.5) blur(0px);
    }
    100% {
        opacity: 0;
        transform: 
            translate(var(--tx), var(--ty)) 
            scale(0.1) 
            rotate(var(--rot));
        filter: brightness(0.5) blur(2px);
    }
}

@keyframes fadeOut {
    0% { opacity: 1; }
    100% { opacity: 0; }
}
</style>
</head>
<body>
<div class="container">
  <div id="board" class="board"></div>
  <br><br><br>
  <div class="picker-area">
    <div id="picker" class="picker"></div>
<br><br><br>
    <button id="rotateBtn" class="rotate-btn" disabled>
      <span style="font-size: 1.2rem;">â†»</span>
    </button>
  </div>
</div>

<div id="gameOver" class="game-over">
  <div class="game-over-content">
    <h2>ğŸ® Oyun Bitti!</h2>
    <p>Tahtada yeterli boÅŸ alan kalmadÄ±.</p>
    
    <div class="stats">
      <div class="stat-item">
        <div class="stat-value" id="finalScore">0</div>
        <div class="stat-label">TOPLAM SKOR</div>
      </div>
      <div class="stat-item">
        <div class="stat-value" id="piecesPlaced">0</div>
        <div class="stat-label">YERLEÅTÄ°RÄ°LEN PARÃ‡A</div>
      </div>
      <div class="stat-item">
        <div class="stat-value" id="linesCleared">0</div>
        <div class="stat-label">TEMÄ°ZLENEN SATIR/SÃœTUN</div>
      </div>
      <div class="stat-item">
        <div class="stat-value" id="gameTime">0</div>
        <div class="stat-label">OYUN SÃœRESÄ° (sn)</div>
      </div>
    </div>
    
    <button class="restart-btn" onclick="restartGame()">ğŸ”„ YENÄ°DEN BAÅLAT</button>
  </div>
</div>

<div class="score-display">
  KarÄ±cÄ±m: <span class="score-value" id="currentScore">0</span> â¤ï¸
</div>



<script>
// Sabitler
const SIZE = 9;

// YENÄ° SHAPES SETÄ° - 10 FARKLI ÅEKÄ°L
const SHAPES = [
  // Nokta (1 blok)
  [[0,0]],

  // KÄ±sa Ã§ubuk (2 blok)
  [[0,0],[1,0]],

  // Uzun Ã§ubuk (4 blok)
  [[0,0],[1,0],[2,0],[3,0]],

  // KÃ¼Ã§Ã¼k T (3 blok)
  //  X
  // XXX
  [[0,1],[1,0],[1,1]],

  // KÃ¼Ã§Ã¼k L (3 blok)
  // X
  // XX
  [[0,0],[0,1],[1,1]],

  // L (4 blok)
  // X
  // X
  // XX
  [[0,0],[0,1],[0,2],[1,2]],

  // Ters L (4 blok)
  //  X
  //  X
  // XX
  [[1,0],[1,1],[1,2],[0,2]],

  // Z (4 blok)
  // XX
  //  XX
  [[0,0],[1,0],[1,1],[2,1]],

  // Ters Z (4 blok)
  //  XX
  // XX
  [[1,0],[2,0],[0,1],[1,1]],

  // 4'lÃ¼ kare (2x2)
  // XX
  // XX
  [[0,0],[1,0],[0,1],[1,1]],
];

// Oyun durumu
let board = Array(SIZE).fill().map(()=>Array(SIZE).fill(0));
let dragging = null;
let activePointerId = null;
let score = 0;
let piecesPlaced = 0;
let linesCleared = 0;
let startTime = null;
let gameActive = true;

// DOM elementleri
const gameOverScreen = document.getElementById('gameOver');
const currentScoreEl = document.getElementById('currentScore');
const finalScoreEl = document.getElementById('finalScore');
const piecesPlacedEl = document.getElementById('piecesPlaced');
const linesClearedEl = document.getElementById('linesCleared');
const gameTimeEl = document.getElementById('gameTime');

const rotateBtn = document.getElementById('rotateBtn');

// Tahta oluÅŸtur
function createBoard(){
  const boardEl = document.getElementById('board');
  boardEl.innerHTML = '';
  
  for(let i=0;i<SIZE*SIZE;i++){
    const cell = document.createElement('div');
    cell.className = 'cell';
    cell.dataset.index = i;
    boardEl.appendChild(cell);
  }
}

// Blok dÃ¶ndÃ¼rme fonksiyonu
function rotateShape90(shape) {
  // Shape'i 90 derece saat yÃ¶nÃ¼nde dÃ¶ndÃ¼r
  // FormÃ¼l: (x, y) -> (y, -x) sonra normalize et
  const rotated = shape.map(([x, y]) => [-y, x]);
  
  // Negatif koordinatlarÄ± normalize et (en kÃ¼Ã§Ã¼k x ve y'yi 0 yap)
  const minX = Math.min(...rotated.map(c => c[0]));
  const minY = Math.min(...rotated.map(c => c[1]));
  
  return rotated.map(([x, y]) => [x - minX, y - minY]);
}

// TÃ¼m parÃ§alarÄ± dÃ¶ndÃ¼r
function rotateAllPieces() {
    if (!gameActive || rotateBtn.disabled) return;
  
  const picker = document.getElementById('picker');
  const pieces = Array.from(picker.children);
  
  if (pieces.length === 0) {
    rotateBtn.disabled = true;
    return;
  }
  
  rotateBtn.disabled = true; // Animasyon sÄ±rasÄ±nda butonu devre dÄ±ÅŸÄ± bÄ±rak
  
  // Her parÃ§ayÄ± dÃ¶ndÃ¼r
  pieces.forEach(piece => {
    // SADECE 90 DERECE DÃ–NDÃœR - Animasyonu doÄŸrudan 90 derece yapalÄ±m
    piece.style.transition = 'transform 0.2s ease';
    piece.style.transform = 'rotate(90deg)';
    
    // Orijinal ÅŸekli al
    const originalShape = piece._shape;
    
    // Yeni ÅŸekli hesapla
    const rotatedShape = rotateShape90(originalShape);
    piece._shape = rotatedShape;
    
    // ParÃ§ayÄ± yeniden oluÅŸtur
    setTimeout(() => {
      // Animasyonu sÄ±fÄ±rla ve gÃ¶rseli gÃ¼ncelle
      piece.style.transition = 'none';
      piece.style.transform = 'rotate(0deg)';
      
      // ParÃ§ayÄ± gÃ¼ncelle
      updatePieceVisual(piece, rotatedShape);
    }, 300);
  });
  
// Butonu tekrar aktif et - DEÄÄ°ÅTÄ°RÄ°LDÄ°
  setTimeout(() => {
    if (gameActive && picker.children.length > 0) {
      rotateBtn.disabled = false;
    }
  }, 400); // 400ms bekle (eski hali 300ms'ti)
}

// ParÃ§anÄ±n gÃ¶rselini gÃ¼ncelle
function updatePieceVisual(piece, shape) {
  // Mevcut iÃ§eriÄŸi temizle
  piece.innerHTML = '';
  
  const color = piece._color;
  const width = Math.max(...shape.map(c => c[0])) + 1;
  const height = Math.max(...shape.map(c => c[1])) + 1;
  
  piece.style.gridTemplateColumns = `repeat(${width}, auto)`;
  piece.style.gridTemplateRows = `repeat(${height}, auto)`;
  
  for(let y = 0; y < height; y++) {
    for(let x = 0; x < width; x++) {
      const slot = document.createElement('div');
      slot.className = 'slot';
      
      const hasBlock = shape.some(cell => cell[0] === x && cell[1] === y);
      
      if(hasBlock) {
        const block = document.createElement('div');
        block.className = 'block';
        block.style.background = color;
        slot.appendChild(block);
      }
      
      piece.appendChild(slot);
    }
  }
  
  // Event listener'larÄ± yeniden ekle
  piece.addEventListener('pointerdown', startDrag, {passive: false});
}

// ParÃ§a oluÅŸtur
function createPiece(shape){
  const piece = document.createElement('div');
  piece.className = 'piece';
  piece.dataset.pieceId = Date.now() + Math.random();
  
  const color = `hsl(${Math.random()*360}, 80%, 60%)`;
  piece._color = color;
  piece._shape = [...shape];
  piece._isDragging = false;
  
  const width = Math.max(...shape.map(c=>c[0])) + 1;
  const height = Math.max(...shape.map(c=>c[1])) + 1;
  
  piece.style.gridTemplateColumns = `repeat(${width}, auto)`;
  piece.style.gridTemplateRows = `repeat(${height}, auto)`;
  
  for(let y=0; y<height; y++){
    for(let x=0; x<width; x++){
      const slot = document.createElement('div');
      slot.className = 'slot';
      
      const hasBlock = shape.some(cell => cell[0] === x && cell[1] === y);
      
      if(hasBlock){
        const block = document.createElement('div');
        block.className = 'block';
        block.style.background = color;
        slot.appendChild(block);
      }
      
      piece.appendChild(slot);
    }
  }
  
  piece.addEventListener('pointerdown', startDrag, {passive: false});
  
  // DÃ¶ndÃ¼rme butonunu aktif et
  rotateBtn.disabled = false;
  
  return piece;
}

// Ghost oluÅŸtur
function createGhost(shape, color){
  const ghost = document.createElement('div');
  ghost.className = 'ghost';
  
  const width = Math.max(...shape.map(c=>c[0])) + 1;
  const height = Math.max(...shape.map(c=>c[1])) + 1;
  
  ghost.style.gridTemplateColumns = `repeat(${width}, var(--cell-size))`;
  ghost.style.gridTemplateRows = `repeat(${height}, var(--cell-size))`;
  
  for(let y=0; y<height; y++){
    for(let x=0; x<width; x++){
      const slot = document.createElement('div');
      slot.style.width = `var(--cell-size)`;
      slot.style.height = `var(--cell-size)`;
      
      const hasBlock = shape.some(cell => cell[0] === x && cell[1] === y);
      
      if(hasBlock){
        const block = document.createElement('div');
        block.style.width = '100%';
        block.style.height = '100%';
        block.style.borderRadius = '6px';
        block.style.background = color;
        block.style.boxShadow = '0 6px 12px rgba(0,0,0,.3)';
        slot.appendChild(block);
      }
      
      ghost.appendChild(slot);
    }
  }
  
  return ghost;
}

// Picker'Ä± doldur
function fillPicker(){
  const picker = document.getElementById('picker');
  picker.innerHTML = '';
  
  for(let i=0;i<3;i++){
    const shape = SHAPES[Math.floor(Math.random()*SHAPES.length)];
    picker.appendChild(createPiece(shape));
  }
  
  // DÃ¶ndÃ¼rme butonunu gÃ¼ncelle
  rotateBtn.disabled = (picker.children.length === 0) || !gameActive;
  

}

// Oyun bitiÅŸ kontrolÃ¼
function checkGameOver(){
  if(!gameActive) return;
  
  const picker = document.getElementById('picker');
  const pieces = Array.from(picker.children);
  
  for(const piece of pieces){
    const shape = piece._shape;
    let canPlaceAnywhere = false;
    
    for(let row=0; row<SIZE && !canPlaceAnywhere; row++){
      for(let col=0; col<SIZE && !canPlaceAnywhere; col++){
        if(canPlacePiece(shape, row, col)){
          canPlaceAnywhere = true;
          break;
        }
      }
    }
    
    if(!canPlaceAnywhere){
      endGame();
      return;
    }
  }
}

// ParÃ§ayÄ± belirli bir konuma yerleÅŸtirebilir miyiz kontrol et
function canPlacePiece(shape, row, col){
  for(const [dx, dy] of shape){
    const r = row + dy;
    const c = col + dx;
    
    if(r<0 || r>=SIZE || c<0 || c>=SIZE || board[r][c]){
      return false;
    }
  }
  return true;
}

// SÃ¼rÃ¼kleme baÅŸlat
function startDrag(e){
  if(!gameActive) return;
  
  e.preventDefault();
  e.stopPropagation();
  
  if(dragging || activePointerId !== null) return;
  
  activePointerId = e.pointerId;
  const piece = e.currentTarget;
  piece._isDragging = true;
  
  const shape = piece._shape;
  const color = piece._color;
  
  const ghost = createGhost(shape, color);
  document.body.appendChild(ghost);
  
  dragging = {
    shape, 
    color, 
    ghost, 
    originalPiece: piece,
    pointerId: e.pointerId
  };
  
  document.addEventListener('pointermove', drag, {passive: false});
  document.addEventListener('pointerup', endDrag, {passive: false});
  document.addEventListener('pointercancel', cancelDrag, {passive: false});
  
  updateGhost(e);
}

// Ghost gÃ¼ncelle
function updateGhost(e){
  if(!dragging || e.pointerId !== dragging.pointerId) return;
  
  const {ghost, shape} = dragging;
  const boardEl = document.getElementById('board');
  const rect = boardEl.getBoundingClientRect();
  
  ghost.style.left = e.clientX + 'px';
  ghost.style.top = e.clientY + 'px';
  
  const cellSize = rect.width / SIZE;
  const centerX = e.clientX - rect.left;
  const centerY = e.clientY - rect.top;
  
  const pieceWidth = shape.reduce((max, [dx, dy]) => Math.max(max, dx + 1), 0);
  const pieceHeight = shape.reduce((max, [dx, dy]) => Math.max(max, dy + 1), 0);
  
  const leftX = centerX - (pieceWidth * cellSize) / 2;
  const topY = centerY - (pieceHeight * cellSize) / 2;
  
  let col = Math.floor(leftX / cellSize);
  let row = Math.floor(topY / cellSize);
  
  col = Math.max(0, Math.min(col, SIZE - pieceWidth));
  row = Math.max(0, Math.min(row, SIZE - pieceHeight));
  
  document.querySelectorAll('.cell.valid, .cell.invalid').forEach(cell=>{
    cell.classList.remove('valid', 'invalid');
  });
  
  let canPlace = true;
  
  for(const [dx, dy] of shape){
    const r = row + dy;
    const c = col + dx;
    
    if(r<0 || r>=SIZE || c<0 || c>=SIZE || board[r][c]){
      canPlace = false;
      break;
    }
  }
  
  for(const [dx, dy] of shape){
    const r = row + dy;
    const c = col + dx;
    
    if(r>=0 && r<SIZE && c>=0 && c<SIZE){
      const index = r * SIZE + c;
      const cell = boardEl.children[index];
      cell.classList.add(canPlace ? 'valid' : 'invalid');
    }
  }
  
  dragging.target = {row, col, canPlace};
}

// SÃ¼rÃ¼kle
function drag(e){
  if(!dragging || e.pointerId !== dragging.pointerId) return;
  e.preventDefault();
  updateGhost(e);
}

// SÃ¼rÃ¼kleme iptal
function cancelDrag(e){
  if(!dragging || e.pointerId !== dragging.pointerId) return;
  
  if(dragging.ghost && dragging.ghost.parentNode){
    dragging.ghost.parentNode.removeChild(dragging.ghost);
  }
  
  document.querySelectorAll('.cell.valid, .cell.invalid').forEach(cell=>{
    cell.classList.remove('valid', 'invalid');
  });
  
  if(dragging.originalPiece){
    dragging.originalPiece._isDragging = false;
  }
  
  document.removeEventListener('pointermove', drag);
  document.removeEventListener('pointerup', endDrag);
  document.removeEventListener('pointercancel', cancelDrag);
  
  dragging = null;
  activePointerId = null;
}

// SÃ¼rÃ¼kleme bitir
function endDrag(e){
  if(!dragging || e.pointerId !== dragging.pointerId) return;
  e.preventDefault();
  
  const {shape, color, originalPiece, target} = dragging;
  const {ghost} = dragging;
  
  if(target && target.canPlace){
    placePiece(shape, target.row, target.col, color);
    
    if(originalPiece && originalPiece.parentNode === document.getElementById('picker')){
      originalPiece.remove();
    }
    
    const picker = document.getElementById('picker');
    if(picker.children.length === 0){
      fillPicker();
    } else {
  
    }
    
    // DÃ¶ndÃ¼rme butonunu gÃ¼ncelle
    rotateBtn.disabled = (picker.children.length === 0) || !gameActive;
  }
  
  if(ghost && ghost.parentNode){
    ghost.parentNode.removeChild(ghost);
  }
  
  document.querySelectorAll('.cell.valid, .cell.invalid').forEach(cell=>{
    cell.classList.remove('valid', 'invalid');
  });
  
  if(originalPiece){
    originalPiece._isDragging = false;
  }
  
  document.removeEventListener('pointermove', drag);
  document.removeEventListener('pointerup', endDrag);
  document.removeEventListener('pointercancel', cancelDrag);
  
  dragging = null;
  activePointerId = null;
}

// ParÃ§a yerleÅŸtir
function placePiece(shape, row, col, color){
  const boardEl = document.getElementById('board');
  
  for(const [dx, dy] of shape){
    const r = row + dy;
    const c = col + dx;
    
    if(r>=0 && r<SIZE && c>=0 && c<SIZE){
      board[r][c] = 1;
      
      const index = r * SIZE + c;
      const cell = boardEl.children[index];
      
      const fill = document.createElement('div');
      fill.className = 'fill';
      fill.style.background = color;
      cell.appendChild(fill);
    }
  }
  
  piecesPlaced++;
  checkLines();
}

// ESKÄ° HALÄ°:
// function showBonusInfo(message, duration = 3000){
//   bonusInfoEl.textContent = message;
//   bonusInfoEl.classList.add('show');
//   
//   setTimeout(() => {
//     bonusInfoEl.classList.remove('show');
//   }, duration);
// }

// YENÄ° HALÄ°:
function showBonusInfo(message, duration = 1){
  // HiÃ§bir ÅŸey yapma - bildirim gÃ¶sterme
  return;
}

// Skor animasyonu gÃ¶ster
// Bu fonksiyonu boÅŸ bÄ±rakÄ±n
function showScoreAnimation(points, x, y, isBonus = false){
  return; // HiÃ§bir animasyon gÃ¶sterme
}

// PARÃ‡ALANMA EFEKTÄ° FONKSÄ°YONU - YENÄ° EKLENDÄ°
function createExplosionEffect(row, col, color) {
    const boardEl = document.getElementById('board');
    const cell = boardEl.children[row * SIZE + col];
    const rect = cell.getBoundingClientRect();
    
    // ParÃ§a sayÄ±sÄ±
    const fragmentCount = 8 + Math.floor(Math.random() * 8);
    
    for(let i = 0; i < fragmentCount; i++) {
        const fragment = document.createElement('div');
        fragment.className = 'fragment';
        
        // Rastgele renk tonu (orijinal renge yakÄ±n)
        const hue = Math.floor(Math.random() * 30) - 15 + parseInt(color.match(/hsl\((\d+)/)?.[1] || 180);
        const saturation = 70 + Math.floor(Math.random() * 20);
        const lightness = 50 + Math.floor(Math.random() * 20);
        fragment.style.background = `hsl(${hue}, ${saturation}%, ${lightness}%)`;
        
        // Rastgele hareket yÃ¶nÃ¼ ve mesafe
        const angle = (Math.random() * Math.PI * 2);
        const distance = 50 + Math.random() * 100;
        const tx = Math.cos(angle) * distance;
        const ty = Math.sin(angle) * distance;
        const rotation = Math.random() * 360;
        
        // CSS deÄŸiÅŸkenleriyle animasyon kontrolÃ¼
        fragment.style.setProperty('--tx', `${tx}px`);
        fragment.style.setProperty('--ty', `${ty}px`);
        fragment.style.setProperty('--rot', `${rotation}deg`);
        
        // Pozisyon
        fragment.style.left = `${rect.left + rect.width/2}px`;
        fragment.style.top = `${rect.top + rect.height/2}px`;
        
        // Boyut varyasyonu
        const size = (Math.random() * 0.5 + 0.5);
        fragment.style.width = `calc(var(--cell-size) / 2 * ${size})`;
        fragment.style.height = `calc(var(--cell-size) / 2 * ${size})`;
        
        document.body.appendChild(fragment);
        
        // Animasyon
        fragment.style.animation = `explode 0.8s ease-out forwards`;
        
        // Animasyon bitince elementi kaldÄ±r
        setTimeout(() => {
            if(fragment.parentNode) {
                fragment.parentNode.removeChild(fragment);
            }
        }, 800);
    }
}

// SatÄ±r/sÃ¼tun silme animasyonu - YENÄ° EKLENDÄ°
function animateLineClear(rows, cols) {
    const boardEl = document.getElementById('board');
    
    // Ã–nce silinecek hÃ¼creleri bul
    const cellsToClear = [];
    
    // Silinecek satÄ±rlarÄ± iÅŸle
    for(const r of rows) {
        for(let c = 0; c < SIZE; c++) {
            if(board[r][c] === 1) {
                const cell = boardEl.children[r * SIZE + c];
                const fill = cell.querySelector('.fill');
                if(fill) {
                    cellsToClear.push({
                        row: r,
                        col: c,
                        color: fill.style.background,
                        element: fill
                    });
                }
            }
        }
    }
    
    // Silinecek sÃ¼tunlarÄ± iÅŸle (Ã§ift saymamak iÃ§in)
    for(const c of cols) {
        for(let r = 0; r < SIZE; r++) {
            // EÄŸer bu hÃ¼cre zaten satÄ±r silmede iÅŸlendiyse atla
            if(rows.includes(r)) continue;
            
            if(board[r][c] === 1) {
                const cell = boardEl.children[r * SIZE + c];
                const fill = cell.querySelector('.fill');
                if(fill) {
                    cellsToClear.push({
                        row: r,
                        col: c,
                        color: fill.style.background,
                        element: fill
                    });
                }
            }
        }
    }
    
    // Her hÃ¼cre iÃ§in animasyonlu parÃ§alanma efekti
    cellsToClear.forEach((cell, index) => {
        setTimeout(() => {
            // Ã–nce mevcut dolguyu kaldÄ±r
            if(cell.element.parentNode) {
                cell.element.parentNode.removeChild(cell.element);
            }
            
            // ParÃ§alanma efekti oluÅŸtur
            createExplosionEffect(cell.row, cell.col, cell.color);
            
        }, index * 20); // Kademeli efekt
    });
    
    return cellsToClear.length;
}

// YENÄ° SKOR SÄ°STEMÄ°: Ã‡apraz bonuslu (satÄ±r + sÃ¼tun + 2)Â²
function calculateScore(clearedRows, clearedCols){
  let newScore = 0;
  let bonusMessage = '';
  let isBonus = false;
  
  // Hem satÄ±r HEM sÃ¼tun silinmiÅŸse (Ã§apraz kesiÅŸme)
  if(clearedRows > 0 && clearedCols > 0){
    // YENÄ° FORMÃœL: (satÄ±r + sÃ¼tun + 2)Â²
    const totalLines = clearedRows + clearedCols + 2;
    newScore = totalLines * totalLines;
    isBonus = true;
    
    // Bonus mesajlarÄ±
    const bonusMessages = [
      `ğŸ¯ Ã‡APRAZ TEMÄ°ZLEME! ${clearedRows} satÄ±r + ${clearedCols} sÃ¼tun`,
      `âš¡ BONUS: (${clearedRows}+${clearedCols}+2)Â² = ${totalLines}Â² = ${newScore} puan!`,
      `ğŸ”¥ MÃœTHÄ°Å! ${clearedRows}Ã—${clearedCols} kesiÅŸme noktasÄ± temizlendi!`
    ];
    bonusMessage = bonusMessages[Math.floor(Math.random() * bonusMessages.length)];
    
  } else if(clearedRows > 0) {
    // Sadece satÄ±r silinmiÅŸse: satÄ±rÂ²
    newScore = clearedRows * clearedRows;
    bonusMessage = `${clearedRows} satÄ±r temizlendi: ${clearedRows}Â² = ${newScore} puan`;
    
  } else if(clearedCols > 0) {
    // Sadece sÃ¼tun silinmiÅŸse: sÃ¼tunÂ²
    newScore = clearedCols * clearedCols;
    bonusMessage = `${clearedCols} sÃ¼tun temizlendi: ${clearedCols}Â² = ${newScore} puan`;
  }
  
  return { score: newScore, message: bonusMessage, isBonus };
}

// Hesaplama Ã¶rneklerini konsola yaz
function logScoreExamples(){
  console.log('ğŸ“Š SKOR HESAPLAMA Ã–RNEKLERÄ°:');
  console.log('=============================');
  console.log('1 satÄ±r + 1 sÃ¼tun: (1+1+2)Â² = 4Â² = 16 puan');
  console.log('1 satÄ±r + 2 sÃ¼tun: (1+2+2)Â² = 5Â² = 25 puan');
  console.log('2 satÄ±r + 1 sÃ¼tun: (2+1+2)Â² = 5Â² = 25 puan');
  console.log('2 satÄ±r + 2 sÃ¼tun: (2+2+2)Â² = 6Â² = 36 puan');
  console.log('2 satÄ±r + 3 sÃ¼tun: (2+3+2)Â² = 7Â² = 49 puan');
  console.log('3 satÄ±r + 2 sÃ¼tun: (3+2+2)Â² = 7Â² = 49 puan');
  console.log('3 satÄ±r + 3 sÃ¼tun: (3+3+2)Â² = 8Â² = 64 puan');
  console.log('3 satÄ±r + 4 sÃ¼tun: (3+4+2)Â² = 9Â² = 81 puan');
  console.log('4 satÄ±r + 3 sÃ¼tun: (4+3+2)Â² = 9Â² = 81 puan');
  console.log('4 satÄ±r + 4 sÃ¼tun: (4+4+2)Â² = 10Â² = 100 puan (MAX!)');
  console.log('=============================');
  
  console.log('ğŸ§© MEVCUT ÅEKÄ°LLER (10 adet):');
  console.log('1. Nokta (1 blok)');
  console.log('2. KÄ±sa Ã§ubuk (2 blok)');
  console.log('3. Uzun Ã§ubuk (4 blok)');
  console.log('4. KÃ¼Ã§Ã¼k T (3 blok)');
  console.log('5. KÃ¼Ã§Ã¼k L (3 blok)');
  console.log('6. L (4 blok)');
  console.log('7. Ters L (4 blok)');
  console.log('8. Z (4 blok)');
  console.log('9. Ters Z (4 blok)');
  console.log('10. 4\'lÃ¼ kare (4 blok)');
}

// Tam satÄ±r/sÃ¼tun kontrolÃ¼ - GÃœNCELLENDÄ° (parÃ§alanma efekti eklendi)
function checkLines(){
  const boardEl = document.getElementById('board');
  let clearedRows = [];
  let clearedCols = [];
  
  // SatÄ±r kontrolÃ¼
  for(let r=0;r<SIZE;r++){
    if(board[r].every(cell=>cell===1)){
      clearedRows.push(r);
    }
  }
  
  // SÃ¼tun kontrolÃ¼
  for(let c=0;c<SIZE;c++){
    let full = true;
    for(let r=0;r<SIZE;r++){
      if(board[r][c]===0){
        full = false;
        break;
      }
    }
    
    if(full){
      clearedCols.push(c);
    }
  }
  
  // Temizlenen satÄ±r/sÃ¼tun varsa iÅŸle
  if(clearedRows.length > 0 || clearedCols.length > 0){
    // Ã–NCE ANÄ°MASYONU GÃ–STER
    const animatedCells = animateLineClear(clearedRows, clearedCols);
    
    // Animasyonun bitmesini bekle (500ms)
    setTimeout(() => {
      // Åimdi satÄ±rlarÄ± temizle
      for(const r of clearedRows){
        for(let c=0;c<SIZE;c++){
          board[r][c] = 0;
          const index = r * SIZE + c;
          const cell = boardEl.children[index];
          // EÄŸer animasyonla kaldÄ±rÄ±lmadÄ±ysa temizle
          if(cell.querySelector('.fill')){
            cell.innerHTML = '';
          }
        }
      }
      
      // Åimdi sÃ¼tunlarÄ± temizle
      for(const c of clearedCols){
        for(let r=0;r<SIZE;r++){
          // Ã‡ift temizleme yapmamak iÃ§in kontrol
          if(clearedRows.includes(r)) continue;
          
          board[r][c] = 0;
          const index = r * SIZE + c;
          const cell = boardEl.children[index];
          // EÄŸer animasyonla kaldÄ±rÄ±lmadÄ±ysa temizle
          if(cell.querySelector('.fill')){
            cell.innerHTML = '';
          }
        }
      }
      
      // Skor hesaplama (MEVCUT KOD - DEÄÄ°ÅMEDEN KALACAK)
      const rowsCount = clearedRows.length;
      const colsCount = clearedCols.length;
      const scoreResult = calculateScore(rowsCount, colsCount);
      
      if(scoreResult.score > 0){
        // Skoru gÃ¼ncelle
        score += scoreResult.score;
        currentScoreEl.textContent = score;
        linesCleared += rowsCount + colsCount;
        
        // Animasyon gÃ¶ster
        const boardRect = boardEl.getBoundingClientRect();
        const centerX = boardRect.left + boardRect.width / 2;
        const centerY = boardRect.top + boardRect.height / 2;
        showScoreAnimation(scoreResult.score, centerX, centerY, scoreResult.isBonus);
        
        // Konsola detaylÄ± bilgi yaz
        console.log(`ğŸ¯ ${rowsCount} satÄ±r + ${colsCount} sÃ¼tun temizlendi`);
        console.log(`ğŸ’¥ ${animatedCells} hÃ¼cre parÃ§alandÄ±`);
        if(rowsCount > 0 && colsCount > 0){
          console.log(`ğŸ“Š BONUS FORMÃœL: (${rowsCount}+${colsCount}+2)Â² = ${rowsCount+colsCount+2}Â² = ${scoreResult.score} puan`);
        }
      }
      
    }, 500); // Animasyon sÃ¼resi
  }
}

// Oyunu bitir
function endGame(){
  if(!gameActive) return;
  
  gameActive = false;
  const gameTime = Math.floor((Date.now() - startTime) / 1000);
  
  finalScoreEl.textContent = score;
  piecesPlacedEl.textContent = piecesPlaced;
  linesClearedEl.textContent = linesCleared;
  gameTimeEl.textContent = gameTime;
  
  // DÃ¶ndÃ¼rme butonunu devre dÄ±ÅŸÄ± bÄ±rak
  rotateBtn.disabled = true;
  
  setTimeout(() => {
    gameOverScreen.classList.add('active');
  }, 500);
}

// Oyunu yeniden baÅŸlat
function restartGame(){
  board = Array(SIZE).fill().map(()=>Array(SIZE).fill(0));
  score = 0;
  piecesPlaced = 0;
  linesCleared = 0;
  gameActive = true;
  startTime = Date.now();
  
  currentScoreEl.textContent = '0';
  gameOverScreen.classList.remove('active');
  
  createBoard();
  fillPicker();

}

// Oyunu baÅŸlat
createBoard();
fillPicker();
startTime = Date.now();

// DÃ¶ndÃ¼rme butonuna event listener ekle
rotateBtn.addEventListener('click', rotateAllPieces);

  // MOBÄ°L DOKUNMATÄ°K Ä°Ã‡Ä°N EKLEYÄ°N:
rotateBtn.addEventListener('touchstart', function(e) {
  e.preventDefault();
  if(!rotateBtn.disabled && gameActive) {
    rotateAllPieces();
  }
}, { passive: false });
  
// Hesaplama Ã¶rneklerini gÃ¶ster
setTimeout(logScoreExamples, 500);


</script>
</body>

</html>
